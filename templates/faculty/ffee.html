{% extends 'base/web-base.html' %}
{% load static %}
{% block container %}

    <section class="w-full min-h-[100vh] h-full bg-blue-100 pb-6">
        <section class="w-[90%] mx-auto">
            <h1 class="font-bold text-[35px] pt-8  text-blue-950 ">FEE DETAILS</h1>
            <div class="w-full h-[500px] bg-green-50 rounded-2xl mt-6 px-5">
                <h3 class="pt-3 font-semibold text-[25px] mb-4  text-blue-950">Fee status:</h3>
                <form method="post" action="{% url 'faculty:change_date' %}">
                    {% csrf_token %}
                    <p>Last date of payment: <input required name="last_date" type="date" id="date" class="font-bold bg-inherit" ></p>
                    <button type="submit" id="updatechange" class="bg-blue-500 hover:bg-blue-700 text-white font-bold px-5 py-2 mt-2 rounded-xl">Update new date</button>
                </form>
                <br><br>


                <div class="overflow-x-auto">
                    <table class="min-w-full border-collapse border border-gray-300 bg-white text-left text-sm text-gray-700">
                        <thead>
                            <tr>
                                <th class="border border-gray-300 bg-blue-200 px-6 py-3 text-gray-800 font-semibold">S.No</th>
                                <th class="border border-gray-300 bg-blue-200 px-6 py-3 text-gray-800 font-semibold">Name</th>
                                <th class="border border-gray-300 bg-blue-200 px-6 py-3 text-gray-800 font-semibold">Status</th>
                                <th class="border border-gray-300 bg-blue-200 px-6 py-3 text-gray-800 font-semibold">Payment Date</th>
                            </tr>
                        </thead>
                        
                        <tbody>
                          
                          {% for student in fees %}
                          <form method="post" action="{% url 'faculty:mark_fee' student.pk %}">
                          {% csrf_token %}
                          <tr class="hover:bg-gray-50">
                            <td class="border border-gray-300 px-6 py-3">{{ forloop.counter }}</td>
                            <td class="border border-gray-300 px-6 py-3">{{ student.student.user.student_name }}</td>
                            {% if student.status == 'paid' %}
                            <td class="border border-gray-300 px-6 py-3 payed text-white font-bold mt-2 rounded-xl mr-3"> ✔️ <a href="{% url 'faculty:delete_fee' student.pk %}" class="bg-red-500 hover:bg-red-700 text-white font-bold px-5 py-2 mt-2 rounded-xl ml-4">Cancel</a></td>
                            <td class="currentdate border border-gray-300 px-6 py-3">
                                <p type="date" class="mr-4 mb-4 px-4 py-2 rounded-md">{{student.fee_date}}</p>
                            </td>
                            {% else %}
                            <td class="border border-gray-300 px-6 py-3"><button type="submit" class="payed bg-blue-500 hover:bg-blue-700 text-white font-bold px-5 py-2 mt-2 rounded-xl mr-3">Payed</button></td>
                            <td class="currentdate border border-gray-300 px-6 py-3">
                                <input type="date" name="paid_date" value="{{ today|date:'Y-m-d' }}" class="mr-4 mb-4 px-4 py-2 rounded-md">
                            </td>
                            {% endif %}
                          </tr>
                          </form>
                          {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </section>

    <script>
        // Get the elements by their IDs
const dateInput = document.getElementById('date');
const changeDateButton = document.getElementById('datechange');
const updateDateButton = document.getElementById('updatechange');

// Add event listener to 'Change date' button
changeDateButton.addEventListener('click', () => {
    dateInput.disabled = false; // Enable the date input
    dateInput.focus(); // Optionally focus the input
});

// Add event listener to 'Update new date' button
updateDateButton.addEventListener('click', () => {
    if (!dateInput.disabled) {
        dateInput.disabled = true; // Disable the date input
    }
});

    </script>

    <script>document.querySelectorAll('.hover\\:bg-gray-50').forEach(row => {
        const payedButton = row.querySelector('.bg-blue-500'); // Select the "Payed" button
        const currentDateCell = row.querySelector('.currentdate'); // Select the current date cell in the same row
    
        payedButton.addEventListener('click', () => {
            // Hide the "Payed" button
            payedButton.style.display = 'none';
    
            // Add a tick mark and a "Cancel" button
            const tickMark = document.createElement('span');
            tickMark.textContent = '✔️';
            tickMark.className = 'ml-2 text-green-500 text-[30px] font-bold';
            payedButton.parentElement.appendChild(tickMark);
    
            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.className = ' bg-red-500 hover:bg-red-700 text-white font-bold px-5 py-2 mt-2 rounded-xl ml-4';
            payedButton.parentElement.appendChild(cancelButton);
    
            // Update the current row's "currentdate" cell to today's date
            const today = new Date().toISOString().split('T')[0];
            currentDateCell.textContent = today;
    
            // Add functionality to the "Cancel" button
            cancelButton.addEventListener('click', () => {
                // Remove tick mark and cancel button
                tickMark.remove();
                cancelButton.remove();
    
                // Show the "Payed" button again
                payedButton.style.display = 'inline-block';
    
                // Reset the current row's "currentdate" cell
                currentDateCell.textContent = '';
            });
        });
    });
    
    </script>
 
 {% endblock %}