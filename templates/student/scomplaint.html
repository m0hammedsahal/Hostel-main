{% extends 'base/web-base.html' %}
{% load static %}
{% block container %}


    <section class="w-[100%] min-h-[100vh] h-full bg-blue-100 pb-6 relative  ">
        <section class="w-[90%] mx-auto">
            <h1 class="font-bold text-[35px] text-blue-950 pt-8">COMPLAINT</h1>
            <form class="w-full min-h-[80vh] pb-6 bg-green-50 rounded-2xl mt-6 px-5 pt-10 " method="post" action="{% url 'student:post_complaint' %}"> 
                {% csrf_token %} 
                <div class=" bg-white rounded-3xl shadow-lg h-[60vh]"> 
                    <textarea id="alert" placeholder="Write complaint here..." class="w-full h-[60vh] rounded-2xl focus:outline-none py-4 px-6 " ></textarea> 
                </div> 
                <button id="complaintsend" class="pl-1 font-semibold w-full bg-blue-500 text-white h-[2cm] mt-5 mr-6 py-1 rounded-lg hover:bg-blue-600">Send</button> 
            </form>
            
        </section>
        <div class="openpopup pl-2 absolute  w-[400px] h-[300px]  bg-[#cccfd6a8] top-[30%] left-[37%] text-center rounded-3xl">
            <h1 class="text-[90px] mb-3">âœ”</h1>

            <h1 class="">your complaint have been successfully <br><span class="font-semibold text-[25px]">submitted</span> </h1>

            <button class="closepopup  bg-[#133a94da] text-white w-[8cm] mt-4 py-2 rounded-md">ok</button>
        </div>
    </section>


    <script>
   // Wait until the DOM content is fully loaded
document.addEventListener("DOMContentLoaded", () => {
    const sendButton = document.getElementById("complaintsend"); // Send button
    const textArea = document.getElementById("alert"); // Textarea
    const popupDiv = document.querySelector(".openpopup"); // Popup div
    const closeButton = document.querySelector(".closepopup"); // OK button in popup

    // Initially hide the popup div
    popupDiv.style.display = "none";

    // Add click event listener for the "Send" button
    sendButton.addEventListener("click", (e) => {
        e.preventDefault(); // Prevent default form submission
        const complaintText = textArea.value.trim(); // Get trimmed value from textarea

        if (complaintText) {
            // Reset textarea value
            textArea.value = "";
            // Show popup div
            popupDiv.style.display = "block";

            // Send AJAX request to post complaint
            fetch('{% url 'student:post_complaint' %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: `complaint=${complaintText}`
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error(error));
        } else {
            alert("Please enter a complaint before sending.");
        }
    });

    // Add click event listener for the "OK" button in popup
    closeButton.addEventListener("click", () => {
        // Hide popup div
        popupDiv.style.display = "none";
    });
});

    </script>

{% endblock %}